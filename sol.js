"use strict";function apply_tilt(t,i,s){var h=s*t.tcos,e=-s*t.tsin,a=Math.sqrt(i**2+h**2+(e-2)**2)/2;return[t.width/2+i/a*t.ruler,t.height/2-h/a*t.ruler,e,a]}function compare_keys(t,i){return t.key==i.key?0:t.key<i.key?-1:1}function draw_circle(t,i,s,h,e){t.ctx.beginPath(),t.ctx.fillStyle=e,t.ctx.arc(i,s,t.ruler*h,0,2*Math.PI),t.ctx.fill()}class Sol{constructor(){this.ready=!1,this.width=0,this.height=0,this.ruler=0,this.canvas=document.getElementById("c"),this.ctx=this.canvas.getContext("2d"),this.elems=[],this.up=0,this.left=0,this.left_rate=.0026179938779914945,this.tilt_phase=1,this.tilt_linear=0,this.tcos=0,this.tsin=0}draw(){this.ctx.beginPath(),this.ctx.fillStyle="black",this.ctx.rect(0,0,this.width,this.height),this.ctx.fill();for(var t=0;t<this.elems.length;++t)this.elems[t].draw(this)}resize(t){this.width=window.innerWidth-1,this.height=window.innerHeight-1,this.ruler=Math.min(this.width,this.height),this.canvas.width=this.width,this.canvas.height=this.height,this.ready&&this.draw()}run(){this.tilt_phase=(this.tilt_phase+.0026179938779914945)%(2*Math.PI),this.left=this.tilt_phase,this.tilt_linear=(1+Math.cos(this.tilt_phase))/2,this.up=Math.PI/2-2.356194490192345*this.tilt_linear,this.tcos=Math.cos(2.356194490192345*this.tilt_linear),this.tsin=Math.sin(2.356194490192345*this.tilt_linear);for(var t=0;t<this.elems.length;++t)this.elems[t].update(this);this.elems.sort(compare_keys),this.draw()}}class Star{constructor(){this.key=0}update(t){}draw(t){draw_circle(t,t.width/2,t.height/2,.05,"yellow")}}class Planet{constructor(t,i,s,h){this.key=0,this.radius=t,this.color=i,this.orbit_r=s,this.orbit_s=h,this.theta=2*Math.random()*Math.PI,this.x=0,this.y=0,this.radius_effective=0}update(t){this.theta=(this.theta+this.orbit_s+t.left_rate)%(2*Math.PI);var i=apply_tilt(t,Math.cos(this.theta)*this.orbit_r,Math.sin(this.theta)*this.orbit_r);this.x=i[0],this.y=i[1],this.key=.001+(Math.abs(i[2])>.01&&i[2]<=0?-this.orbit_r:this.orbit_r),this.radius_effective=this.radius/i[3]}draw(t){draw_circle(t,this.x,this.y,this.radius_effective,this.color)}}class Moon{constructor(){this.key=0,this.theta1=2*Math.random()*Math.PI,this.theta2=2*Math.random()*Math.PI,this.x=0,this.y=0,this.radius_effective=0}update(t){}draw(t){draw_circle(t,this.x,this.y,this.radius_effective,"gray")}}class Earth{constructor(){this.key=0,this.moon=new Moon,this.x=0,this.y=0,this.radius_effective=0}update(t){this.moon.theta1=(this.moon.theta1+.00150526+t.left_rate)%(2*Math.PI),this.moon.theta2=(this.moon.theta2+.0201232)%(2*Math.PI);var i=.3333*Math.cos(this.moon.theta1),s=.3333*Math.sin(this.moon.theta1),h=Math.cos(this.moon.theta2),e=Math.sin(this.moon.theta2),a=i+.003*h,r=s+.003*e,l=apply_tilt(t,a,r);this.x=l[0],this.y=l[1],this.key=.001+(Math.abs(l[2])>.01&&l[2]<=0?-.3333:.3333),this.radius_effective=.01/l[3],a=i-.04*h,r=s-.04*e;var n=l[2];l=apply_tilt(t,a,r);this.moon.x=l[0],this.moon.y=l[1],this.moon.key=.001+(Math.abs(l[2])>.01&&l[2]<=0?-.3333:.3333)+(l[2]<=n?-5e-4:5e-4),this.moon.radius_effective=.005/l[3]}draw(t){draw_circle(t,this.x,this.y,this.radius_effective,"blue")}}class Ring{constructor(t,i){this.key=-t*i,this.radius=t,this.factor=i}update(t){}draw(t){t.ctx.beginPath(),t.ctx.lineWidth=t.ruler/200,t.ctx.strokeStyle="rgba(256,0,256,0.4)";for(var i=0;i<=15;++i){var s=Math.PI/15*i,h=apply_tilt(t,Math.cos(s)*this.radius,Math.sin(s)*this.radius*this.factor);t.ctx.lineTo(h[0],h[1])}t.ctx.stroke()}}class Back{constructor(){for(this.key=-8,this.vecs=[];this.vecs.length<500;){for(var t=[],i=0;i<3;++i)t.push(2*Math.random()-1);var s=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);if(s>.1&&s<1){for(i=0;i<3;++i)t[i]/=s;this.vecs.push(t)}}this.ruler=-8,this.img=null,this.left=-8,this.c1=0,this.s1=0,this.up=-8,this.c2=0,this.s2=0}update(t){if(this.ruler!=t.ruler){this.ruler=t.ruler,this.img=document.createElement("canvas");var i=parseInt(t.ruler/400);0==i&&(i=1),this.img.width=2*i,this.img.height=2*i;var s=this.img.getContext("2d");s.beginPath(),s.fillStyle="white",s.arc(i,i,i,0,2*Math.PI),s.fill()}this.left!=t.left&&(this.left=t.left,this.c1=Math.cos(t.left),this.s1=Math.sin(t.left)),this.up!=t.up&&(this.up=t.up,this.c2=Math.cos(t.up),this.s2=Math.sin(t.up))}draw(t){for(var i=0;i<this.vecs.length;++i){var s=this.vecs[i],h=this.s1*s[0]+this.c1*s[1],e=[this.c1*s[0]-this.s1*s[1],this.c2*h-this.s2*s[2],this.s2*h+this.c2*s[2]];if(!(e[1]<0)){e[1]+=1;var a=2/e[1]*(t.ruler/20/.02499479361892016);e[0]*=a,e[2]*=a,Math.abs(e[0]-this.img.width)>t.width/2||Math.abs(e[3]-this.img.height)>t.height/2||t.ctx.drawImage(this.img,t.width/2+e[0]-this.img.width/2,t.height/2-e[2]-this.img.height/2)}}}}function main(){if("loading"==document.readyState)setTimeout(main,10);else{var t=new Sol;t.elems.push(new Star),t.elems.push(new Planet(.005,"gray",.1333,.00625)),t.elems.push(new Ring(.1333,1)),t.elems.push(new Ring(.1333,-1)),t.elems.push(new Planet(.01,"#f7f7d4",.2222,.00244685)),t.elems.push(new Ring(.2222,1)),t.elems.push(new Ring(.2222,-1)),t.elems.push(new Planet(1/150,"red",.4444,800301e-9)),t.elems.push(new Ring(.4444,1)),t.elems.push(new Ring(.4444,-1));var i=new Earth;t.elems.push(i),t.elems.push(i.moon),t.elems.push(new Ring(.3333,1)),t.elems.push(new Ring(.3333,-1)),t.elems.push(new Back),setInterval(t.run.bind(t),50),window.addEventListener("resize",t.resize.bind(t)),t.resize(),t.ready=!0}}main();